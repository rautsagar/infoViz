<!DOCTYPE html>
<html lang="en">

	<head>
		<meta charset="UTF-8" />
		<title>Reading from CSV</title>
		<link rel="stylesheet" type="text/css" href="style/style.css" />

		<script src="js/jquery-2.0.3.js"></script>
		<script src="d3/d3.v3.js"></script>
		<script>
			$(document).ready(function() {

				$("button#update").click(function() {
					var X = $("#xdropdown").val();
					var Y = $("#ydropdown").val();
					// var result = {};
					getFromCSV(X, Y);
					//console.log(JSON.stringify(result));

				});

				function getFromCSV(X, Y) {

					resultJSON = d3.csv('a3-CoffeeData.csv', function(data) {

						var resultJSON = {};
						var arrayOfY = getNumberOfCategories(data, Y);

						for (var j = 0; j < arrayOfY.length; j++) {
							var sumOfX = 0;

							for (var i = 0; i < data.length; i++) {
								var obj = data[i];
								if (obj[Y] == arrayOfY[j]) {
									sumOfX += parseInt(obj[X]);
								}

							}

							resultJSON[arrayOfY[j]] = sumOfX;
						}
						drawBarChart(resultJSON);

					});

				}

			 function getNumberOfCategories(data, Y) {
					var categoryArray = [];

					for (var i = 0; i < data.length; i++) {
						var obj = data[i];

						if (categoryArray.indexOf(obj[Y]) < 0) {
							categoryArray.push(obj[Y]);
						}
					}

					return categoryArray;
				}

			});

			function drawBarChart(resultJSON) {
				$("svg").remove();
				var maxValue = 0;
				var h = 500;
				var w = 100;
				var padding = 30;
				
				for (var keyz in resultJSON) {
					var attrName = keyz;
					var attrValue = resultJSON[keyz];
					
					if(attrValue > maxValue){
						maxValue = attrValue;
					};
					console.log(attrName, attrValue);
					
				}
				
				console.log("MaxValue is:", maxValue);
				
				var xScale = d3.scale.linear()
                     .domain([maxValue, 0])
                     .range([0, h]);
                     
                var xAxis = d3.svg.axis()
                  .scale(xScale)
                  .orient("right");
     
				
				var svg = d3.select("#graphArea").append("svg").attr("width",700).attr("height", 700);
				
				svg.append("g")
						.attr("class", "axis")
						.call(xAxis)
						.attr("transform", "translate(" + padding + ","+ (padding) +")");
						
				
				var dataset = d3.entries(resultJSON);
				
						
				svg.selectAll("rect")
					.data(dataset)
					.enter()
					.append("rect")
					.attr("class", "bar")
					.attr("x", function(d,i){
						return padding+100+(i*(w+10));
					})
					.attr("y", function(d){
						return (h-((d.value/maxValue)*500))+padding;
					})
					.attr("width" , w)
					.attr("height", function(d,i){
						return ((d.value/maxValue)*500);
					} );
					
						
				 
				    
					
					
					
					

			}

		</script>

	</head>
	<body>

		<div id="container">
			<div id="controls">
				<label>X:</label>
				<select id="xdropdown">
					<option val="sales">sales</option>
					<option val="profit">profit</option>
				</select>

				<label>Y:</label>
				<select id="ydropdown">
					<option val="region">region</option>
					<option val="category">category</option>
				</select>

				<button name="refresh" id="update">
					Update
				</button>
			</div>
			<div id="graphArea">

			</div>
		</div>

	</body>
</html>